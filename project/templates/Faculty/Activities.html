{% extends './Faculty/base.html' %}
{% block content %}
<div class="container mt-5">
    <h2><i class="bi bi-list-check"></i> Your Activities</h2>

    <!-- Filters -->
    <div class="card shadow-sm p-3 my-4">
        <div class="d-flex flex-wrap gap-2 align-items-center">
            <strong>Filters:</strong>
            <select class="form-select w-auto" aria-label="Academic Year Filter">
                <option selected>All Academic Years</option>
                {% for year in academic_years %}
                    <option value="{{ year.ID }}">{{ year.YearStart }}-{{ year.YearEnd }}</option>
                {% endfor %}
            </select>

            <select class="form-select w-auto" aria-label="Activity Type Filter">
                <option selected>All Activity Types</option>
                {% for type in activity_types %}
                    <option value="{{ type.ID }}">{{ type.Name }}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <!-- Add Activity Button -->
    <div class="mb-3 text-end">
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addActivityModal">
            <i class="bi bi-plus-circle"></i> Add New Activity
        </button>
    </div>

    <!-- Activity Cards -->
    <div class="row g-3">
        {% for activity, type_name, category, year_start, year_end in activities %}
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title"><i class="bi bi-easel2-fill"></i> {{ activity.Name }}</h5>
                    <span class="badge bg-light text-dark float-end">{{ activity.Date.strftime('%d/%m/%Y') }}</span>
                    <p><i class="bi bi-info-circle"></i> <a href="#">{{ activity.Title }}</a></p>
                    <p>
                        <i class="bi bi-tags"></i>
                        <span class="text-primary">Type:</span> {{ type_name }} ({{ category }})<br>
                        <i class="bi bi-calendar3"></i>
                        <span class="text-primary">Academic Year:</span> {{ year_start }}-{{ year_end }}
                    </p>
                    {% if activity.Description %}
                    <p class="text-muted">{{ activity.Description }}</p>
                    {% endif %}
                </div>
                <div class="card-footer text-end">
                    <button class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#editActivityModal{{ activity.ID }}">
                        <i class="bi bi-pencil-square"></i> Edit
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Add Activity Modal -->
<div class="modal fade" id="addActivityModal" tabindex="-1" aria-labelledby="addActivityModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <form method="POST" action="{{ url_for('add_activity') }}">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addActivityModalLabel">Add New Activity</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">

          <div class="mb-3">
            <label class="form-label">Activity Name</label>
            <input type="text" class="form-control" name="activity_name" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Official Title / Theme</label>
            <input type="text" class="form-control" name="title" required>
          </div>

          <div class="row mb-3">
            <div class="col">
              <label class="form-label">Date of Activity</label>
              <input type="date" class="form-control" name="date" required>
            </div>
            <div class="col">
              <label class="form-label">Academic Year</label>
              <select class="form-select" name="academic_year" required>
                {% for year in academic_years %}
                  <option value="{{ year.ID }}">{{ year.YearStart }}-{{ year.YearEnd }}</option>
                {% endfor %}
              </select>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Description (Optional)</label>
            <textarea class="form-control" name="description" rows="3"></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label">Activity Type</label>
            <select class="form-select" name="activity_type" required>
              {% for type in activity_types %}
                <option value="{{ type.ID }}">{{ type.Name }} ({{ type.Category }})</option>
              {% endfor %}
            </select>
          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Add Activity</button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Edit Activity Modals -->
{% for activity, type_name, category, year_start, year_end in activities %}
<div class="modal fade" id="editActivityModal{{ activity.ID }}" tabindex="-1" aria-labelledby="editActivityModalLabel{{ activity.ID }}" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <form method="POST" action="{{ url_for('edit_activity', id=activity.ID) }}">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editActivityModalLabel{{ activity.ID }}">Edit Activity</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">

          <div class="mb-3">
            <label class="form-label">Activity Name</label>
            <input type="text" class="form-control" name="activity_name" value="{{ activity.Name }}" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Official Title / Theme</label>
            <input type="text" class="form-control" name="title" value="{{ activity.Title }}" required>
          </div>

          <div class="row mb-3">
            <div class="col">
              <label class="form-label">Date of Activity</label>
              <input type="date" class="form-control" name="date" value="{{ activity.Date.isoformat() }}" required>
            </div>
            <div class="col">
              <label class="form-label">Academic Year</label>
              <select class="form-select" name="academic_year" required>
                {% for year in academic_years %}
                  <option value="{{ year.ID }}" {% if year.ID == activity.AcademicYearID %}selected{% endif %}>
                    {{ year.YearStart }}-{{ year.YearEnd }}
                  </option>
                {% endfor %}
              </select>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Description (Optional)</label>
            <textarea class="form-control" name="description">{{ activity.Description }}</textarea>
          </div>

          <div class="mb-3">
            <label class="form-label">Activity Type</label>
            <select class="form-select" name="activity_type" required>
              {% for type in activity_types %}
                <option value="{{ type.ID }}" {% if type.ID == activity.ActivityTypeID %}selected{% endif %}>
                  {{ type.Name }} ({{ type.Category }})
                </option>
              {% endfor %}
            </select>
          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-success">Save Changes</button>
        </div>
      </div>
    </form>
  </div>
</div>
{% endfor %}
{% endblock %}
